<%= render "shared/bottom_navbar" %>

<!-- Add Google Fonts -->
<head>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
</head>

<style>
  body {
    font-family: 'Roboto', sans-serif;
    background-color: #f9fafb;
    margin: 0;
    padding: 20px;
  }

  .container {
    max-width: 900px;
    margin: auto;
  }

  h1, h2 {
    color: #333;
  }

  .card {
    background: #fff;
    border-radius: 10px;
    padding: 24px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    margin-bottom: 30px;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 12px;
  }

  thead th {
    text-align: left;
    color: #555;
    font-weight: 600;
    padding-bottom: 12px;
    border-bottom: 2px solid #ddd;
  }

  tbody tr {
    background-color: #fefefe;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    transition: background-color 0.3s ease;
  }

  tbody tr:hover {
    background-color: #f0f7ff;
  }

  tbody td {
    padding: 14px 12px;
    color: #444;
  }

  tfoot td {
    font-weight: 700;
    font-size: 1.1em;
    padding-top: 16px;
    border-top: 2px solid #ddd;
    text-align: right;
  }

  .footer {
    font-size: 0.85rem;
    color: #444;
    margin-top: 40px;
  }

  .btn-primary {
    background-color: #2563eb;
    color: white;
    border: none;
    padding: 14px 28px;
    font-size: 1.1em;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease;
    display: inline-block;
    margin-top: 20px;
    text-decoration: none;
  }

  .btn-primary:hover {
    background-color: #1d4ed8;
  }

  .summary-label {
    font-weight: 600;
    margin-top: 1rem;
    display: block;
  }
</style>

<div class="container">
  <h1>Order Confirmation</h1>

  <div class="card">
    <strong>Hi <%= current_user.name || "there" %>,</strong>
    <p>Thank you for your purchase. Your order has been received and is now being processed.</p>

    <p class="summary-label">Order #: <%= @order.id %></p>
    <p class="summary-label">Order Date: <%= @order.created_at.strftime("%B %-d, %Y") %></p>
    <p class="summary-label">Estimated Delivery: <%= (@order.created_at + 20.minutes).strftime("%B %-d, %Y") %></p>
  </div>

  <div class="card">
    <h2>Shipping Details</h2>
    <p><strong>Name:</strong> <%= current_user.name %></p>
    <p><strong>Email:</strong> <%= current_user.email %></p>
    <p><strong>Address:</strong> <%= current_user.address %></p>
  </div>

  <div class="card">
    <h2>Items Ordered</h2>
    <table>
      <thead>
        <tr>
          <th>Product</th>
          <th style="text-align:center;">Quantity</th>
          <th style="text-align:right;">Price (each)</th>
          <th style="text-align:right;">Total</th>
        </tr>
      </thead>
      <tbody>
        <% total = 0 %>
        <% @order.basket.basket_items.each do |item| %>
          <% price = PharmacyProduct.find_by(pharmacy_id: @order.pharmacy_id, product_id: item.product_id)&.price || 0 %>
          <% quantity = item.quantity || 1 %>
          <% item_total = price * quantity %>
          <% total += item_total %>
          <tr>
            <td><%= item.product.name %></td>
            <td style="text-align:center;"><%= quantity %></td>
            <td style="text-align:right;">£<%= '%.2f' % price %></td>
            <td style="text-align:right;">£<%= '%.2f' % item_total %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3">Drone Delivery Charge</td>
          <td style="text-align:right;">£10.00</td>
        </tr>
        <tr>
          <td colspan="3">Total Payment</td>
          <td style="text-align:right;">£<%= '%.2f' % (total + 10) %></td>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="footer">
    <p>You’ll receive another message once your order ships with tracking details.</p>
    <p>Thank you for shopping with MedFly!</p>
    <%= link_to "Back to My Account", my_account_path, class: "btn-primary" %>
  </div>
</div>
